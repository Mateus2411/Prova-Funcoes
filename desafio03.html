<script>
  /*  ## Problema 3: Sistema de Estoque de Produtos com Preço

    **DESAFIO:** Crie um sistema robusto que valide todas as entradas, permita manipulação completa do estoque e gere relatórios detalhados.

    ### Requisitos:

    1. Função para validar entrada: Valide quantidade e preço (use while para re-solicitar dados inválidos).
    2. Função para adicionar produto: Adicione nome, quantidade e preço ao array.
    3. Função para remover produto: Remova um produto específico do array.
    4. Função para listar produtos por faixa de preço: Use for e if...else para filtrar:


    5. Função para alertar sobre estoque baixo: Identifique produtos com quantidade <= 5.
    6. Menu interativo: Use while com if...else aninhado para navegação.

    Contexto: Uma loja pequena precisa gerenciar seu estoque. O sistema deve permitir adicionar produtos, remover, ajustar preços, e gerar relatórios de produtos caros, baratos e com baixo estoque.
    - Produtos baratos (< R$ 50)
    - Produtos médios (R$ 50 a R$ 150)
    - Produtos caros (> R$ 150)
    Dados Iniciais:

    ```javascript
    let nomeProdutos = ["Arroz", "Feijão", "Açúcar", "Sal"];
    let quantidades = [50, 30, 20, 15];
    let precos = [3.50, 8.00, 4.50, 2.00];
    ```
    */

  // Nomes: Mateus e Bruno 1info3

  // #region Base Início

  let produtos = [
    { nome: "Arroz", quantidade: 50, preco: 3.5 },
    { nome: "Feijão", quantidade: 30, preco: 8 },
    { nome: "Açúcar", quantidade: 20, preco: 4.5 },
    { nome: "Sal", quantidade: 15, preco: 2 },
  ];

  // Função map
  function map() {
    return produtos
      .map((p, i) => `${i + 1}. ${p.nome} - R$${p.preco}`)
      .join("\n");
  }
  /*
  Função que mapeia os itens do array de elementos e trandorma/manipula como quiser
  */

  let opcao = "";
  do {
    opcao = prompt(
      "O que deseja fazer:\n" +
        "(1) Adicionar produto\n" +
        "(2) Remover produto\n" +
        "(3) Ajustar preço\n" +
        "(4) Gerar relatório\n" +
        "(0) Sair"
    )
      ?.trim()
      .toLowerCase();

    if (opcao === "1" || opcao === "adicionar") adicionar();
    else if (opcao === "2" || opcao === "remover") remover();
    else if (opcao === "3" || opcao === "ajustar preço" || opcao === "ajustar precos") ajustarPrecos();
    else if (opcao === "4" || opcao === "gerar relatorio") relatorio();
  } while (opcao !== "0");
  // #endregion

  // #region Validar o Nome
  /*
  Verifica se a um produto com o nome ja existente
  */

  function validarNome(nomeProduto) {
    if (!nomeProduto) return false;

    for (let i = 0; i < produtos.length; i++) {
      if (nomeProduto.toLowerCase() === produtos[i].nome.toLowerCase()) {
        alert("Esse produto já existe no estoque!");
        return false;
      }
    }
    return true;
  }
  // #endregion

  //#region Adicionar
  function adicionar() {
    let nome = "";
    let quantidade = 0;
    let preco = 0;

    do {
      nome = prompt("Nome do produto:");
    } while (!nome || !validarNome(nome));

    do {
      quantidade = Number(prompt("Quantidade:"));
    } while (isNaN(quantidade) || quantidade <= 0);

    do {
      preco = Number(prompt("Preço:"));
    } while (isNaN(preco) || preco <= 0);

    produtos.push({ nome, quantidade, preco });
    alert("Produto adicionado com sucesso!");
  }
  //#endregion

  //#region Remover
  function remover() {
    let lista = map();

    let nomeRemover = prompt("Qual produto deseja remover?\n\n" + lista);

    if (!nomeRemover) return;

    let removido = false;

    for (let i = 0; i < produtos.length; i++) {
      if (nomeRemover.toLowerCase() === produtos[i].nome.toLowerCase()) {
        produtos.splice(i, 1);
        alert("Produto removido!");
        removido = true;
        break;
      }
    }

    if (!removido) alert("Produto não encontrado!");
  }
  //#endregion

  //#region Ajustar os Preços

  function ajustarPrecos() {
    let lista = map();

    let nome = prompt("Selecione o produto para ajustar o preço:\n\n" + lista);

    if (!nome) return;

    let encontrado = false;

    for (let i = 0; i < produtos.length; i++) {
      if (nome.toLowerCase() === produtos[i].nome.toLowerCase()) {
        let novoPreco;
        do {
          novoPreco = Number(prompt("Novo preço:"));
        } while (isNaN(novoPreco) || novoPreco <= 0);

        produtos[i].preco = novoPreco;
        alert("Preço ajustado!");
        encontrado = true;
        break;
      }
    }

    if (!encontrado) alert("Produto não encontrado!");
  }
  //#endregion
  
  //#region Relatório

  function relatorio() {
    let baratos = [];
    let medios = [];
    let caros = [];
    let poucos = [];

    for (let p of produtos) {
      if (p.preco < 50) baratos.push(`${p.nome} - R$${p.preco}`);
      else if (p.preco <= 150) medios.push(`${p.nome} - R$${p.preco}`);
      else caros.push(`${p.nome} - R$${p.preco}`);

      if (p.quantidade <= 5) {
        poucos.push(`${p.nome} - Quantidade: ${p.quantidade}`);
      }
    }

    if (
      baratos.length > 0 ||
      medios.length > 0 ||
      caros.length > 0 ||
      poucos.length > 0
    ) {
      alert(
        (baratos.length ? `Produtos Baratos:\n${baratos.join(", ")}\n\n` : "") +
          (medios.length ? `Produtos Médios:\n${medios.join(", ")}\n\n` : "") +
          (caros.length ? `Produtos Caros:\n${caros.join(", ")}\n\n` : "") +
          (poucos.length ? `Estoque Baixo:\n${poucos.join(", ")}` : "")
      );
    }
  }
  //#endregion
</script>